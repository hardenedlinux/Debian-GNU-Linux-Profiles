<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2017-12-31 Sun 23:57 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Hardened Linux-Network Security Monitoring</title>
<meta name="generator" content="Org mode">
<meta name="author" content="GTruN">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://www.gtrun.org/theme/sugano-styles-dark.css" rel="stylesheet" type="text/css" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2017 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<header>
<h1 class="title">Hardened Linux-Network Security Monitoring</h1>
</header><nav id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org38f547b">1. Overview</a>
<ul>
<li><a href="#orgbd54efb">1.1. Configuration</a>
<ul>
<li><a href="#org0dfc431">1.1.1. Topology</a></li>
<li><a href="#org54f781e">1.1.2. Bro</a></li>
<li><a href="#org6f0a886">1.1.3. ELK</a></li>
<li><a href="#org3277762">1.1.4. Suricata</a></li>
<li><a href="#org3651a13">1.1.5. Snort</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org02b02a8">2. Adding Patterns for ELk</a>
<ul>
<li><a href="#org5e5bb24">2.1. Bro</a>
<ul>
<li><a href="#org2ce6299">2.1.1. More information</a></li>
</ul>
</li>
<li><a href="#orgb95cd79">2.2. Suricata &amp; Snort</a>
<ul>
<li><a href="#orga2a0668">2.2.1. More Information</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org843cfad">3. Adding a dashboard of data type</a>
<ul>
<li><a href="#org584db15">3.1. Bro</a>
<ul>
<li><a href="#orga3cbb4b">3.1.1. More Information</a></li>
</ul>
</li>
<li><a href="#org7f95b22">3.2. Snort &amp; Suricata</a></li>
</ul>
</li>
<li><a href="#orgbdfa26f">4. Reference</a></li>
</ul>
</div>
</nav>
<div id="outline-container-org38f547b" class="outline-2">
<h2 id="org38f547b"><span class="section-number-2">1</span> Overview</h2>
<div class="outline-text-2" id="text-1">
<p>
Nowadays, security analyst who are too busy to collect data through reading long tutorials and tedious processes. In this document that you don't need to learn each open source platform, just enough knowledge to be self-sufficient.If youâ€™re a security analyst responsible for investigating alerts,  researching data, or responding to incidents then this document will be very useful and easy to help you building your own investigation platform.
</p>
</div>
<div id="outline-container-orgbd54efb" class="outline-3">
<h3 id="orgbd54efb"><span class="section-number-3">1.1</span> Configuration</h3>
<div class="outline-text-3" id="text-1-1">
</div>
<div id="outline-container-org0dfc431" class="outline-4">
<h4 id="org0dfc431"><span class="section-number-4">1.1.1</span> Topology</h4>
<div class="outline-text-4" id="text-1-1-1">
<p>
Demo test:
</p>

<figure>
<img src="img/DemoTest-topology.png" alt="DemoTest-topology.png" width="700">

</figure>
</div>
</div>
<div id="outline-container-org54f781e" class="outline-4">
<h4 id="org54f781e"><span class="section-number-4">1.1.2</span> Bro</h4>
<div class="outline-text-4" id="text-1-1-2">
<p>
First, review the <a href="https://github.com/hardenedlinux/Debian-GNU-Linux-Profiles/blob/master/docs/ids/bro-ids.md">installing bro on Debian</a> Page.
</p>
<ul class="org-ul">
<li>configure Bro JSON logging 
Add to this line <code>@load tuning/json-logs</code> to <code>/usr/local/bro/share/bro/site/local.bro</code></li>
</ul>
</div>

<ol class="org-ol">
<li><a id="orgf3f22c5"></a>openssh<br>
<div class="outline-text-5" id="text-1-1-2-1">
<p>
how to configure a Bro cluster <a href="https://www.bro.org/sphinx/cluster/index.html">https://www.bro.org/sphinx/cluster/index.html</a> learn more information. 
</p>
<ol class="org-ol">
<li>SSH login without password</li>
</ol>
<p>
Step 1: Create public and private keys using ssh-key-gen on manager-host, you need that make sure that login in on <code>root</code> user. that's important for you.
Step 2: Copy the public key to sensor-host using ssh-copy-id.
other steps, you know how to do that.
</p>
<ol class="org-ol">
<li>configure your worker(s) in <code>/usr/local/bro/etc/node.cfg</code>:</li>
</ol>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #4f97d7;">[</span>manager<span style="color: #4f97d7;">]</span>
<span style="color: #7590db;">type</span>=manager
<span style="color: #7590db;">host</span>=<span style="color: #a45bad;">192.168.1.8</span> <span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">manager host</span>
 <span style="color: #2aa1ae; background-color: #292e34;">#</span>
<span style="color: #4f97d7;">[</span>proxy-1<span style="color: #4f97d7;">]</span>
<span style="color: #7590db;">type</span>=proxy
<span style="color: #7590db;">host</span>=<span style="color: #a45bad;">192.168.1.8</span> <span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">manager host</span>
<span style="color: #2aa1ae; background-color: #292e34;">#</span>
<span style="color: #4f97d7;">[</span>worker-1<span style="color: #4f97d7;">]</span>
<span style="color: #7590db;">type</span>=worker
<span style="color: #7590db;">host</span>=<span style="color: #a45bad;">192.168.1.10</span> <span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">sensor host</span>
<span style="color: #7590db;">interface</span>=ens192
</pre>
</div>
<p>
3.Then start up a Bro instance:
</p>

<p>
[BroControl] &gt; start
             &gt; deploy
             &gt; status  //Reconfirm everything looks like good.
manager      manager 192.168.1.8      running   3929   22 Dec 18:30:05
proxy-1      proxy   192.168.1.8      running   3971   22 Dec 18:30:07
worker-1     worker  192.168.1.10     running   13662  18 Dec 12:13:14
</p>
</div>
</li>
<li><a id="org554c17a"></a>Syslog<br>
<div class="outline-text-5" id="text-1-1-2-2">
<p>
Syslog configs are default stored in <code>/etc/syslog/syslog.conf</code>
Syslog for your system following the instructions here. The following commands will category the source data of the bro:
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #2aa1ae; background-color: #292e34;">## </span><span style="color: #2aa1ae; background-color: #292e34;">Lines to add to /etc/syslog-ng/syslog-ng.conf</span>
<span style="color: #4f97d7;">source</span> s_bro_conn <span style="color: #4f97d7;">{</span> file<span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"/usr/local/bro/logs/current/conn.log"</span> flags<span style="color: #2d9574;">(</span>no-parse<span style="color: #2d9574;">)</span> program_override<span style="color: #2d9574;">(</span><span style="color: #2d9574;">"bro_conn"</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span>; <span style="color: #4f97d7;">}</span>;
<span style="color: #4f97d7;">source</span> s_bro_http <span style="color: #4f97d7;">{</span> file<span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"/usr/local/bro/logs/current/http.log"</span> flags<span style="color: #2d9574;">(</span>no-parse<span style="color: #2d9574;">)</span> program_override<span style="color: #2d9574;">(</span><span style="color: #2d9574;">"bro_http"</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span>; <span style="color: #4f97d7;">}</span>;
<span style="color: #4f97d7;">source</span> s_bro_dns <span style="color: #4f97d7;">{</span> file<span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"/usr/local/bro/logs/current/dns.log"</span> flags<span style="color: #2d9574;">(</span>no-parse<span style="color: #2d9574;">)</span> program_override<span style="color: #2d9574;">(</span><span style="color: #2d9574;">"bro_dns"</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span>; <span style="color: #4f97d7;">}</span>;
<span style="color: #4f97d7;">source</span> s_bro_files <span style="color: #4f97d7;">{</span> file<span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"/usr/local/bro/logs/current/files.log"</span> flags<span style="color: #2d9574;">(</span>no-parse<span style="color: #2d9574;">)</span> program_override<span style="color: #2d9574;">(</span><span style="color: #2d9574;">"bro_files"</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span>; <span style="color: #4f97d7;">}</span>;
<span style="color: #4f97d7;">source</span> s_bro_dhcp <span style="color: #4f97d7;">{</span> file<span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"/usr/local/bro/logs/current/dhcp.log"</span> flags<span style="color: #2d9574;">(</span>no-parse<span style="color: #2d9574;">)</span> program_override<span style="color: #2d9574;">(</span><span style="color: #2d9574;">"bro_dhcp"</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span>; <span style="color: #4f97d7;">}</span>;
<span style="color: #4f97d7;">source</span> s_bro_weird <span style="color: #4f97d7;">{</span> file<span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"/usr/local/bro/logs/current/weird.log"</span> flags<span style="color: #2d9574;">(</span>no-parse<span style="color: #2d9574;">)</span> program_override<span style="color: #2d9574;">(</span><span style="color: #2d9574;">"bro_weird"</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span>; <span style="color: #4f97d7;">}</span>;
<span style="color: #4f97d7;">source</span> s_bro_tunnels <span style="color: #4f97d7;">{</span> file<span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"/usr/local/bro/logs/current/tunnel.log"</span> flags<span style="color: #2d9574;">(</span>no-parse<span style="color: #2d9574;">)</span> program_override<span style="color: #2d9574;">(</span><span style="color: #2d9574;">"bro_tunnels"</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span>; <span style="color: #4f97d7;">}</span>;
<span style="color: #4f97d7;">source</span> s_bro_syslog <span style="color: #4f97d7;">{</span> file<span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"/usr/local/bro/logs/current/syslog.log"</span> flags<span style="color: #2d9574;">(</span>no-parse<span style="color: #2d9574;">)</span> program_override<span style="color: #2d9574;">(</span><span style="color: #2d9574;">"bro_syslog"</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span>; <span style="color: #4f97d7;">}</span>;
<span style="color: #4f97d7;">source</span> s_bro_ftp <span style="color: #4f97d7;">{</span> file<span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"/usr/local/bro/logs/current/ftp.log"</span> flags<span style="color: #2d9574;">(</span>no-parse<span style="color: #2d9574;">)</span> program_override<span style="color: #2d9574;">(</span><span style="color: #2d9574;">"bro_ftp"</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span>; <span style="color: #4f97d7;">}</span>;
<span style="color: #4f97d7;">source</span> s_bro_notice <span style="color: #4f97d7;">{</span> file<span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"/usr/local/bro/logs/current/notice.log"</span> flags<span style="color: #2d9574;">(</span>no-parse<span style="color: #2d9574;">)</span> program_override<span style="color: #2d9574;">(</span><span style="color: #2d9574;">"bro_notice"</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span>; <span style="color: #4f97d7;">}</span>;
<span style="color: #4f97d7;">source</span> s_bro_smtp <span style="color: #4f97d7;">{</span> file<span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"/usr/local/bro/logs/current/smtp.log"</span> flags<span style="color: #2d9574;">(</span>no-parse<span style="color: #2d9574;">)</span> program_override<span style="color: #2d9574;">(</span><span style="color: #2d9574;">"bro_smtp"</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span>; <span style="color: #4f97d7;">}</span>;
<span style="color: #4f97d7;">source</span> s_bro_smtp_entities <span style="color: #4f97d7;">{</span> file<span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"/usr/local/bro/logs/current/smtp_entities.log"</span> flags<span style="color: #2d9574;">(</span>no-parse<span style="color: #2d9574;">)</span> program_override<span style="color: #2d9574;">(</span><span style="color: #2d9574;">"bro_smtp_entities"</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span>; <span style="color: #4f97d7;">}</span>;
<span style="color: #4f97d7;">source</span> s_bro_ssl <span style="color: #4f97d7;">{</span> file<span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"/usr/local/bro/logs/current/ssl.log"</span> flags<span style="color: #2d9574;">(</span>no-parse<span style="color: #2d9574;">)</span> program_override<span style="color: #2d9574;">(</span><span style="color: #2d9574;">"bro_ssl"</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span>; <span style="color: #4f97d7;">}</span>;
<span style="color: #4f97d7;">source</span> s_bro_software <span style="color: #4f97d7;">{</span> file<span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"/usr/local/bro/logs/current/software.log"</span> flags<span style="color: #2d9574;">(</span>no-parse<span style="color: #2d9574;">)</span> program_override<span style="color: #2d9574;">(</span><span style="color: #2d9574;">"bro_software"</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span>; <span style="color: #4f97d7;">}</span>;
<span style="color: #4f97d7;">source</span> s_bro_irc <span style="color: #4f97d7;">{</span> file<span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"/usr/local/bro/logs/current/irc.log"</span> flags<span style="color: #2d9574;">(</span>no-parse<span style="color: #2d9574;">)</span> program_override<span style="color: #2d9574;">(</span><span style="color: #2d9574;">"bro_irc"</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span>; <span style="color: #4f97d7;">}</span>;
<span style="color: #4f97d7;">source</span> s_bro_ssh <span style="color: #4f97d7;">{</span> file<span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"/usr/local/bro/logs/current/ssh.log"</span> flags<span style="color: #2d9574;">(</span>no-parse<span style="color: #2d9574;">)</span> program_override<span style="color: #2d9574;">(</span><span style="color: #2d9574;">"bro_ssh"</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span>; <span style="color: #4f97d7;">}</span>;
<span style="color: #4f97d7;">source</span> s_bro_intel <span style="color: #4f97d7;">{</span> file<span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"/usr/local/bro/logs/current/intel.log"</span> flags<span style="color: #2d9574;">(</span>no-parse<span style="color: #2d9574;">)</span> program_override<span style="color: #2d9574;">(</span><span style="color: #2d9574;">"bro_intel"</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span>; <span style="color: #4f97d7;">}</span>;
<span style="color: #4f97d7;">source</span> s_bro_x509 <span style="color: #4f97d7;">{</span> file<span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"/usr/local/bro/logs/current/x509.log"</span> flags<span style="color: #2d9574;">(</span>no-parse<span style="color: #2d9574;">)</span> program_override<span style="color: #2d9574;">(</span><span style="color: #2d9574;">"bro_x509"</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span>; <span style="color: #4f97d7;">}</span>;
<span style="color: #4f97d7;">source</span> s_bro_snmp <span style="color: #4f97d7;">{</span> file<span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"/usr/local/bro/logs/current/snmp.log"</span> flags<span style="color: #2d9574;">(</span>no-parse<span style="color: #2d9574;">)</span> program_override<span style="color: #2d9574;">(</span><span style="color: #2d9574;">"bro_snmp"</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span>; <span style="color: #4f97d7;">}</span>;
<span style="color: #4f97d7;">source</span> s_bro_radius <span style="color: #4f97d7;">{</span> file<span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"/usr/local/bro/logs/current/radius.log"</span> flags<span style="color: #2d9574;">(</span>no-parse<span style="color: #2d9574;">)</span> program_override<span style="color: #2d9574;">(</span><span style="color: #2d9574;">"bro_radius"</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span>; <span style="color: #4f97d7;">}</span>;
<span style="color: #4f97d7;">source</span> s_bro_mysql <span style="color: #4f97d7;">{</span> file<span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"/usr/local/bro/logs/current/mysql.log"</span> flags<span style="color: #2d9574;">(</span>no-parse<span style="color: #2d9574;">)</span> program_override<span style="color: #2d9574;">(</span><span style="color: #2d9574;">"bro_mysql"</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span>; <span style="color: #4f97d7;">}</span>;
<span style="color: #4f97d7;">source</span> s_bro_kerberos <span style="color: #4f97d7;">{</span> file<span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"/usr/local/bro/logs/current/kerberos.log"</span> flags<span style="color: #2d9574;">(</span>no-parse<span style="color: #2d9574;">)</span> program_override<span style="color: #2d9574;">(</span><span style="color: #2d9574;">"bro_kerberos"</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span>; <span style="color: #4f97d7;">}</span>;
<span style="color: #4f97d7;">source</span> s_bro_rdp <span style="color: #4f97d7;">{</span> file<span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"/usr/local/bro/logs/current/rdp.log"</span> flags<span style="color: #2d9574;">(</span>no-parse<span style="color: #2d9574;">)</span> program_override<span style="color: #2d9574;">(</span><span style="color: #2d9574;">"bro_rdp"</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span>; <span style="color: #4f97d7;">}</span>;
<span style="color: #4f97d7;">source</span> s_bro_pe <span style="color: #4f97d7;">{</span> file<span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"/usr/local/bro/logs/current/pe.log"</span> flags<span style="color: #2d9574;">(</span>no-parse<span style="color: #2d9574;">)</span> program_override<span style="color: #2d9574;">(</span><span style="color: #2d9574;">"bro_pe"</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span>; <span style="color: #4f97d7;">}</span>;
<span style="color: #4f97d7;">source</span> s_bro_sip <span style="color: #4f97d7;">{</span> file<span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"/usr/local/bro/logs/current/sip.log"</span> flags<span style="color: #2d9574;">(</span>no-parse<span style="color: #2d9574;">)</span> program_override<span style="color: #2d9574;">(</span><span style="color: #2d9574;">"bro_sip"</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span>; <span style="color: #4f97d7;">}</span>;
<span style="color: #4f97d7;">source</span> s_bro_smb_mapping <span style="color: #4f97d7;">{</span> file<span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"/usr/local/bro/logs/current/smb_mapping.log"</span> flags<span style="color: #2d9574;">(</span>no-parse<span style="color: #2d9574;">)</span> program_override<span style="color: #2d9574;">(</span><span style="color: #2d9574;">"bro_smb_mapping"</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span>; <span style="color: #4f97d7;">}</span>;
<span style="color: #4f97d7;">source</span> s_bro_smb_files <span style="color: #4f97d7;">{</span> file<span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"/usr/local/bro/logs/current/smb_files.log"</span> flags<span style="color: #2d9574;">(</span>no-parse<span style="color: #2d9574;">)</span> program_override<span style="color: #2d9574;">(</span><span style="color: #2d9574;">"bro_smb_files"</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span>; <span style="color: #4f97d7;">}</span>;
<span style="color: #4f97d7;">source</span> s_bro_ntlm <span style="color: #4f97d7;">{</span> file<span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"/usr/local/bro/logs/current/ntlm.log"</span> flags<span style="color: #2d9574;">(</span>no-parse<span style="color: #2d9574;">)</span> program_override<span style="color: #2d9574;">(</span><span style="color: #2d9574;">"bro_ntlm"</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span>; <span style="color: #4f97d7;">}</span>;
<span style="color: #4f97d7;">source</span> s_bro_dce_rpc <span style="color: #4f97d7;">{</span> file<span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"/usr/local/bro/logs/current/dce_rpc.log"</span> flags<span style="color: #2d9574;">(</span>no-parse<span style="color: #2d9574;">)</span> program_override<span style="color: #2d9574;">(</span><span style="color: #2d9574;">"bro_dce_rpc"</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span>; <span style="color: #4f97d7;">}</span>;
<span style="color: #4f97d7;">source</span> s_bro_modbus <span style="color: #4f97d7;">{</span> file<span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"/usr/local/bro/logs/current/modbus.log"</span> flags<span style="color: #2d9574;">(</span>no-parse<span style="color: #2d9574;">)</span> program_override<span style="color: #2d9574;">(</span><span style="color: #2d9574;">"bro_modbus"</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span>; <span style="color: #4f97d7;">}</span>;
<span style="color: #4f97d7;">source</span> s_bro_dnp3 <span style="color: #4f97d7;">{</span> file<span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"/usr/local/bro/logs/current/dnp3.log"</span> flags<span style="color: #2d9574;">(</span>no-parse<span style="color: #2d9574;">)</span> program_override<span style="color: #2d9574;">(</span><span style="color: #2d9574;">"bro_dnp3"</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span>; <span style="color: #4f97d7;">}</span>;
<span style="color: #4f97d7;">source</span> s_bro_rfb <span style="color: #4f97d7;">{</span> file<span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"/usr/local/bro/logs/current/rfb.log"</span> flags<span style="color: #2d9574;">(</span>no-parse<span style="color: #2d9574;">)</span> program_override<span style="color: #2d9574;">(</span><span style="color: #2d9574;">"bro_rfb"</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span>; <span style="color: #4f97d7;">}</span>;

destination d_bro <span style="color: #4f97d7;">{</span> network<span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"192.168.1.8"</span> port<span style="color: #2d9574;">(</span><span style="color: #a45bad;">1000</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span>; <span style="color: #4f97d7;">}</span>; <span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">manager host</span>

<span style="color: #4f97d7;">log</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #4f97d7;">source</span><span style="color: #bc6ec5;">(</span>s_bro_conn<span style="color: #bc6ec5;">)</span>;
    <span style="color: #4f97d7;">source</span><span style="color: #bc6ec5;">(</span>s_bro_http<span style="color: #bc6ec5;">)</span>;
    <span style="color: #4f97d7;">source</span><span style="color: #bc6ec5;">(</span>s_bro_dns<span style="color: #bc6ec5;">)</span>;
    <span style="color: #4f97d7;">source</span><span style="color: #bc6ec5;">(</span>s_bro_weird<span style="color: #bc6ec5;">)</span>;
    <span style="color: #4f97d7;">source</span><span style="color: #bc6ec5;">(</span>s_bro_tunnels<span style="color: #bc6ec5;">)</span>;
    <span style="color: #4f97d7;">source</span><span style="color: #bc6ec5;">(</span>s_bro_syslog<span style="color: #bc6ec5;">)</span>;
    <span style="color: #4f97d7;">source</span><span style="color: #bc6ec5;">(</span>s_bro_ftp<span style="color: #bc6ec5;">)</span>;
    <span style="color: #4f97d7;">source</span><span style="color: #bc6ec5;">(</span>s_bro_files<span style="color: #bc6ec5;">)</span>;
    <span style="color: #4f97d7;">source</span><span style="color: #bc6ec5;">(</span>s_bro_dhcp<span style="color: #bc6ec5;">)</span>;
    <span style="color: #4f97d7;">source</span><span style="color: #bc6ec5;">(</span>s_bro_notice<span style="color: #bc6ec5;">)</span>;
    <span style="color: #4f97d7;">source</span><span style="color: #bc6ec5;">(</span>s_bro_smtp<span style="color: #bc6ec5;">)</span>;
    <span style="color: #4f97d7;">source</span><span style="color: #bc6ec5;">(</span>s_bro_smtp_entities<span style="color: #bc6ec5;">)</span>;
    <span style="color: #4f97d7;">source</span><span style="color: #bc6ec5;">(</span>s_bro_ssl<span style="color: #bc6ec5;">)</span>;
    <span style="color: #4f97d7;">source</span><span style="color: #bc6ec5;">(</span>s_bro_irc<span style="color: #bc6ec5;">)</span>;
    <span style="color: #4f97d7;">source</span><span style="color: #bc6ec5;">(</span>s_bro_software<span style="color: #bc6ec5;">)</span>;
    <span style="color: #4f97d7;">source</span><span style="color: #bc6ec5;">(</span>s_bro_ssh<span style="color: #bc6ec5;">)</span>;
    <span style="color: #4f97d7;">source</span><span style="color: #bc6ec5;">(</span>s_bro_smb_mapping<span style="color: #bc6ec5;">)</span>;
    <span style="color: #4f97d7;">source</span><span style="color: #bc6ec5;">(</span>s_bro_smb_files<span style="color: #bc6ec5;">)</span>;
    <span style="color: #4f97d7;">source</span><span style="color: #bc6ec5;">(</span>s_bro_ntlm<span style="color: #bc6ec5;">)</span>;
    <span style="color: #4f97d7;">source</span><span style="color: #bc6ec5;">(</span>s_bro_dce_rpc<span style="color: #bc6ec5;">)</span>;
    <span style="color: #4f97d7;">source</span><span style="color: #bc6ec5;">(</span>s_bro_intel<span style="color: #bc6ec5;">)</span>;
    <span style="color: #4f97d7;">source</span><span style="color: #bc6ec5;">(</span>s_bro_x509<span style="color: #bc6ec5;">)</span>;
    <span style="color: #4f97d7;">source</span><span style="color: #bc6ec5;">(</span>s_bro_snmp<span style="color: #bc6ec5;">)</span>;
    <span style="color: #4f97d7;">source</span><span style="color: #bc6ec5;">(</span>s_bro_radius<span style="color: #bc6ec5;">)</span>;
    <span style="color: #4f97d7;">source</span><span style="color: #bc6ec5;">(</span>s_bro_mysql<span style="color: #bc6ec5;">)</span>;
    <span style="color: #4f97d7;">source</span><span style="color: #bc6ec5;">(</span>s_bro_kerberos<span style="color: #bc6ec5;">)</span>;
    <span style="color: #4f97d7;">source</span><span style="color: #bc6ec5;">(</span>s_bro_rdp<span style="color: #bc6ec5;">)</span>;
    <span style="color: #4f97d7;">source</span><span style="color: #bc6ec5;">(</span>s_bro_pe<span style="color: #bc6ec5;">)</span>;
    <span style="color: #4f97d7;">source</span><span style="color: #bc6ec5;">(</span>s_bro_sip<span style="color: #bc6ec5;">)</span>;
    <span style="color: #4f97d7;">source</span><span style="color: #bc6ec5;">(</span>s_bro_modbus<span style="color: #bc6ec5;">)</span>;
    <span style="color: #4f97d7;">source</span><span style="color: #bc6ec5;">(</span>s_bro_dnp3<span style="color: #bc6ec5;">)</span>;
    <span style="color: #4f97d7;">source</span><span style="color: #bc6ec5;">(</span>s_bro_rfb<span style="color: #bc6ec5;">)</span>;
    <span style="color: #4f97d7;">log</span> <span style="color: #bc6ec5;">{</span> destination<span style="color: #2d9574;">(</span>d_bro<span style="color: #2d9574;">)</span>; <span style="color: #bc6ec5;">}</span>;
<span style="color: #4f97d7;">}</span>;
</pre>
</div>
</div>
</li>
<li><a id="org2468595"></a>logstrash<br>
<div class="outline-text-5" id="text-1-1-2-3">
<p>
 They are consumed by syslog-ng and stored in ELK.
the configuring file in <code>/etc/logstash/conf.d/</code>, create <code>bro.conf</code> at here and add following command to this conf file.
</p>
<pre class="example">
if you did install ELK, just skiped here.

</pre>
<div class="org-src-container">
<pre class="src src-sh">input <span style="color: #4f97d7;">{</span>
    syslog <span style="color: #bc6ec5;">{</span>
        <span style="color: #7590db;">port</span> =&gt; <span style="color: #2d9574;">"1000"</span> <span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">destination port</span>
    <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>

filter <span style="color: #4f97d7;">{</span>
    json <span style="color: #bc6ec5;">{</span>
        <span style="color: #7590db;">source</span> =&gt; <span style="color: #2d9574;">"message"</span>
    <span style="color: #bc6ec5;">}</span>

    mutate <span style="color: #bc6ec5;">{</span>
        <span style="color: #7590db;">remove_field</span> =&gt; <span style="color: #2d9574;">[</span><span style="color: #2d9574;">"message"</span><span style="color: #2d9574;">]</span>
        <span style="color: #7590db;">rename</span> =&gt; <span style="color: #2d9574;">{</span>
            <span style="color: #2d9574;">"id.orig_h"</span> =&gt; <span style="color: #2d9574;">"srcip"</span>
            <span style="color: #2d9574;">"id.orig_p"</span> =&gt; <span style="color: #2d9574;">"srcport"</span>
            <span style="color: #2d9574;">"id.resp_h"</span> =&gt; <span style="color: #2d9574;">"dstip"</span>
            <span style="color: #2d9574;">"id.resp_p"</span> =&gt; <span style="color: #2d9574;">"dstport"</span>
            <span style="color: #2d9574;">"orig_bytes"</span> =&gt; <span style="color: #2d9574;">"src_bytes"</span>
            <span style="color: #2d9574;">"resp_bytes"</span> =&gt; <span style="color: #2d9574;">"dst_bytes"</span>
        <span style="color: #2d9574;">}</span>
    <span style="color: #bc6ec5;">}</span>

    geoip <span style="color: #bc6ec5;">{</span>
        <span style="color: #7590db;">source</span> =&gt; <span style="color: #2d9574;">"srcip"</span>
        <span style="color: #7590db;">target</span> =&gt; <span style="color: #2d9574;">"geoip_src"</span>
    <span style="color: #bc6ec5;">}</span>

    geoip <span style="color: #bc6ec5;">{</span>
        <span style="color: #7590db;">source</span> =&gt; <span style="color: #2d9574;">"dstip"</span>
        <span style="color: #7590db;">target</span> =&gt; <span style="color: #2d9574;">"geoip_dst"</span>
    <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>

output <span style="color: #4f97d7;">{</span>

    elasticsearch <span style="color: #bc6ec5;">{</span>
        <span style="color: #7590db;">hosts</span> =&gt; <span style="color: #2d9574;">[</span><span style="color: #2d9574;">"localhost:9200"</span><span style="color: #2d9574;">]</span>
        <span style="color: #7590db;">index</span> =&gt; <span style="color: #2d9574;">"bro"</span>
    <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
</div>
</li>
</ol>
</div>
<div id="outline-container-org6f0a886" class="outline-4">
<h4 id="org6f0a886"><span class="section-number-4">1.1.3</span> ELK</h4>
<div class="outline-text-4" id="text-1-1-3">
</div>
<ol class="org-ol">
<li><a id="org7c673be"></a>Installing ELK<br>
<div class="outline-text-5" id="text-1-1-3-1">
<div class="org-src-container">
<pre class="src src-sh">Download and install ELK for your system following the instructions here.
 sudo apt-get install openjdk-8-jre
 sudo dpkg -i elasticsearch-6.0.0.deb
 sudo /bin/systemctl daemon-reload
 sudo /bin/systemctl enable elasticsearch.service
 sudo systemctl start elasticsearch.service 
</pre>
</div>
<p>
<code>Other tools's</code> (kibana/logstrash) installed in a pretty similar process for that
we're going to go website to the download page for logstash and others
Finally, Checking your feedback information, we should have log stash installed correctly environment and it looks like
everything got done or no errors.
<code>curl -XGET localhost:9200</code>
</p>

<p>
 we're going to use the template for ELK that based on Security onion
 <a href="https://github.com/Security-Onion-Solutions/elastic-test">https://github.com/Security-Onion-Solutions/elastic-test</a>
Modify this  option  <code>config.reload.automatic: false</code> false to true which is going to enable this automatic configuration, After that we are going to go down here below it remove this interval to 3 table to default setting which is saying that every 3 seconds log says <code>config.reload.interval: 3s</code>
Until this time we were finished all process for Logstash, restart serif again ~~
</p>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Elasticserach</th>
<th scope="col" class="org-left">&#xa0;</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Search</td>
<td class="org-left">inverted indexs</td>
</tr>

<tr>
<td class="org-left">structured data</td>
<td class="org-left">Json</td>
</tr>

<tr>
<td class="org-left">components</td>
<td class="org-left">document, value, indes, types</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>
</div>
</li>
</ol>
</div>
<div id="outline-container-org3277762" class="outline-4">
<h4 id="org3277762"><span class="section-number-4">1.1.4</span> Suricata</h4>
<div class="outline-text-4" id="text-1-1-4">
<ul class="org-ul">
<li>Download and install Suricata for your system following the instructions here.</li>
</ul>
<p>
The default installation path is <code>/usr/local/bin/</code>, use the default configuration in <code>/usr/local/etc/suricata/</code> and will output to <code>/usr/local/var/log/suricata</code>.
</p>
<div class="org-src-container">
<pre class="src src-sh">sudo apt-get install libyaml-dev
wget https://www.openinfosecfoundation.org/download/suricata-4.0.3.tar.gz
tar xzvf suricata-4.0.0.tar.gz
<span style="color: #4f97d7;">cd</span> suricata-4.0.0
./configure
make
make install
</pre>
</div>
<p>
now, enter this command test that suricata is working correctly:
<code>ps aux| grep suricata</code>
</p>
</div>
</div>

<div id="outline-container-org3651a13" class="outline-4">
<h4 id="org3651a13"><span class="section-number-4">1.1.5</span> Snort</h4>
<div class="outline-text-4" id="text-1-1-5">
</div>
<ol class="org-ol">
<li><a id="org417d033"></a>Installing Snort for you system<br>
<div class="outline-text-5" id="text-1-1-5-1">
<ol class="org-ol">
<li><p>
Installing the Data Acquisition Library (DAQ)
</p>
<div class="org-src-container">
<pre class="src src-sh">sudo apt-get install aptitude
sudo aptitude install -y gcc flex bison make libpcap-dev libdnet-dev libdumbnet-dev libpcre3-dev libghc-zlib-dev
wget https://www.snort.org/downloads/snort/daq-2.0.6.tar.gz
tar -xvzf daq-2.0.6.tar.gz
<span style="color: #4f97d7;">cd</span> daq-2.0.6
./configure
sudo make &amp;&amp; sudo make install
</pre>
</div></li>
<li>Installing Snort</li>
</ol>
<p>
Installing from source  <a href="https://www.snort.org/downloads/">https://www.snort.org/downloads/</a>
</p>
<div class="org-src-container">
<pre class="src src-sh">wget https://www.snort.org/downloads/snort/snort-2.9.11.tar.gz
tar -xvzf snort-2.9.11.tar.gz
<span style="color: #4f97d7;">cd</span> snort-2.9.11/
./configure --enable-sourcefire &amp;&amp; make &amp;&amp; sudo make install
</pre>
</div>


<ol class="org-ol">
<li>Once we have Snort installed, we need to make sure that our shared libraries are up to date. We can do this using the command:</li>
</ol>
<p>
<code>sudo ldconfig</code>
The resulting output will resemble the following:
</p>
<div class="org-src-container">
<pre class="src src-sh">sudo snort --v

  ,,_     -*&gt; Snort! &lt;*-
 o<span style="color: #2d9574;">"  )~   Version 2.9.11 GRE (Build 125)</span>
<span style="color: #2d9574;">  ''''    By Martin Roesch &amp; The Snort Team: http://www.snort.org/contact#team</span>
<span style="color: #2d9574;">          Copyright (C) 2014-2017 Cisco and/or its affiliates. All rights reserved.</span>
<span style="color: #2d9574;">          Copyright (C) 1998-2013 Sourcefire, Inc., et al.</span>
<span style="color: #2d9574;">          Using libpcap version 1.8.1</span>
<span style="color: #2d9574;">          Using PCRE version: 8.39 2016-06-14</span>
<span style="color: #2d9574;">          Using ZLIB version: 1.2.8</span>
</pre>
</div>

<ol class="org-ol">
<li>How to setup the configuration files</li>
<li>Snort on Debian gets installed to <code>/usr/local/bin/snort</code> directory. So we need to create a symlink:
<code>sudo ln -s /usr/local/bin/snort /usr/sbin/snort</code></li>
<li>To create a new user and group for running as root user</li>
</ol>
<div class="org-src-container">
<pre class="src src-sh">sudo groupadd snort
sudo useradd snort -r -s /sbin/nologin -c SNORT_IDS -g snort
</pre>
</div>
<ul class="org-ul">
<li>After we create the directories(Such as log files and config files) and the rules:</li>
</ul>

<p>
before we can add any rules, we need a place to store the dynamic rules. 
</p>

<p>
<code>sudo mkdir /usr/local/lib/snort_dynamicrules</code>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">sudo mkdir /etc/snort
sudo mkdir /etc/snort/rules
sudo mkdir /etc/snort/preproc_rules
sudo touch /etc/snort/rules/white_list.rules /etc/snort/rules/black_list.rules /etc/snort/rules/local.rules

sudo chmod -R <span style="color: #a45bad;">5775</span> /etc/snort
sudo chmod -R <span style="color: #a45bad;">5775</span> /var/log/snort
sudo chmod -R <span style="color: #a45bad;">5775</span> /usr/local/lib/snort_dynamicrules
sudo chown -R snort:snort /etc/snort
sudo chown -R snort:snort /var/log/snort
sudo chown -R snort:snort /usr/local/lib/snort_dynamicrules
</pre>
</div>


<p>
Copy over the configuration files from <code>/home/User/snort-2.9.11/etc</code>
</p>
<div class="org-src-container">
<pre class="src src-sh">sudo cp *.conf* /etc/snort
sudo cp *.map /etc/snort
</pre>
</div>
</div>
</li>

<li><a id="orgd63f2ab"></a>Installing Snort3(++) for you system<br>
<div class="outline-text-5" id="text-1-1-5-2">
<ul class="org-ul">
<li>build-essential: provides the build tools (GCC and the like) to compile software.</li>
<li>bison, flex: parsers required by DAQ (DAQ is installed later below).</li>
<li>libpcap-dev: Library for network traffic capture required by Snort.</li>
<li>libpcre3-dev: Library of functions to support regular expressions required by Snort.</li>
<li>libdumbnet-dev: the libdnet library provides a simplified, portable interface to several low-level networking routines. Many guides for installing Snort install this library from source, although that is not necessary.</li>
<li>zlib1g-dev: A compression library required by Snort.</li>
<li>liblzma-dev: Provides decompression of swf files (adobe flash)</li>
<li>openssl and libssl-dev: Provides SHA and MD5 file signatures</li>
<li>1. Installing the Data Acquisition Library (DAQ)
First we need to install all the Snort pre-requisites from the Debian repositories:</li>
</ul>
<div class="org-src-container">
<pre class="src src-sh">  sudo apt-get install -y build-essential autotools-dev libdumbnet-dev libluajit-5.1-dev libpcap-dev libpcre3-dev zlib1g-dev pkg-config libhwloc-dev cmake
  sudo apt-get install -y liblzma-dev openssl libssl-dev cpputest libsqlite3-dev
  sudo apt-get install -y bison flex
  sudo apt-get install -y libtool git autoconf
  sudo apt-get install -y asciidoc dblatex source-highlight

  <span style="color: #2aa1ae; background-color: #292e34;">#############################</span>
  <span style="color: #2aa1ae; background-color: #292e34;">##</span><span style="color: #2aa1ae; background-color: #292e34;">create a directory to save the downloaded tarball files:</span>

  <span style="color: #2aa1ae; background-color: #292e34;">###</span><span style="color: #2aa1ae; background-color: #292e34;">DAQ</span>
  mkdir ~/snort_src
  <span style="color: #4f97d7;">cd</span> ~/snort_src
  wget https://www.snort.org/downloads/snortplus/daq-2.2.2.tar.gz
  tar -xvzf daq-2.2.2.tar.gz
  <span style="color: #4f97d7;">cd</span> daq-2.2.2/
  ./configure
  make
  sudo make install
  <span style="color: #2aa1ae; background-color: #292e34;">#############</span>
  <span style="color: #4f97d7;">cd</span> ~/snort_src
  wget http://downloads.sourceforge.net/project/safeclib/libsafec-10052013.tar.gz
  tar -xzvf libsafec-10052013.tar.gz
  <span style="color: #4f97d7;">cd</span> libsafec-10052013
  ./configure
  make
  sudo make install

  <span style="color: #4f97d7;">cd</span> ~/snort_src
  wget http://www.colm.net/files/ragel/ragel-6.10.tar.gz
  tar -xzvf ragel-6.10.tar.gz
  <span style="color: #4f97d7;">cd</span> ragel-6.10
  ./configure
  make
  sudo make install


  <span style="color: #2aa1ae; background-color: #292e34;">###</span><span style="color: #2aa1ae; background-color: #292e34;">Download the Boost 1.64 libraries, but do not install:</span>

  <span style="color: #4f97d7;">cd</span> ~/snort_src
  wget https://dl.bintray.com/boostorg/release/1.64.0/source/boost_1_64_0.tar.gz
  tar -xvzf boost_1_64_0.tar.gz


  <span style="color: #4f97d7;">cd</span> ~/snort_src
  wget https://github.com/01org/hyperscan/archive/v4.5.2.tar.gz
  tar -xvzf v4.5.2.tar.gz

  <span style="color: #4f97d7;">cd</span> hyperscan-4.5.2
  cmake -DCMAKE_INSTALL_PREFIX=/usr/local -DBOOST_ROOT=~/snort_src/boost_1_64_0/ ../hyperscan-4.5.2

  make
  sudo make install

  <span style="color: #2aa1ae; background-color: #292e34;">###</span><span style="color: #2aa1ae; background-color: #292e34;">Run the following command to update shared libraries:</span>

  sudo ldconfig


  <span style="color: #2aa1ae; background-color: #292e34;">###</span>
  git clone  https://github.com/snortadmin/snort3.git
  <span style="color: #4f97d7;">cd</span> snort3/
  autoreconf -isvf 
  ./configure --prefix=/opt/snort
  make
  sudo make install
  <span style="color: #2aa1ae; background-color: #292e34;">###</span><span style="color: #2aa1ae; background-color: #292e34;">create a symlink to /usr/sbin/snort</span>
  sudo ln -s /opt/snort/bin/snort /usr/sbin/snort


<span style="color: #2aa1ae; background-color: #292e34;">## </span><span style="color: #2aa1ae; background-color: #292e34;">Set up the environment</span>
  sh -c <span style="color: #2d9574;">"echo 'export LUA_PATH=/opt/snort/include/snort/lua/\?.lua\;\;' &gt;&gt; ~/.bashrc"</span>
  sh -c <span style="color: #2d9574;">"echo 'export SNORT_LUA_PATH=/opt/snort/etc/snort' &gt;&gt; ~/.bashrc"</span>

<span style="color: #2aa1ae; background-color: #292e34;">## </span><span style="color: #2aa1ae; background-color: #292e34;">To run Snort on Debian as root access</span>

sudo visudo
Defaults <span style="color: #7590db;">env_keep</span> += <span style="color: #2d9574;">"LUA_PATH SNORT_LUA_PATH"</span>
</pre>
</div>


<p>
The resulting output will resemble the following:
</p>

<p>
<code>sudo snort -V</code>:
</p>

<p>
 ,,_     -<b>&gt; Snort++ &lt;</b>-
o"  )~   Version 3.0.0 (Build 241) from 2.9.11
 ''''    By Martin Roesch &amp; The Snort Team
         <a href="http://snort.org/contact#team">http://snort.org/contact#team</a>
         Copyright (C) 2014-2017 Cisco and/or its affiliates. All rights reserved.
         Copyright (C) 1998-2013 Sourcefire, Inc., et al.
         Using DAQ version 2.2.2
         Using LuaJIT version 2.0.4
         Using OpenSSL 1.1.0f  25 May 2017
         Using libpcap version 1.8.1
         Using PCRE version 8.39 2016-06-14
         Using ZLIB version 1.2.8
         Using Hyperscan version 4.5.2 2017-12-30
         Using LZMA version 5.2.2
</p>


<ul class="org-ul">
<li>Using snort3-community rules</li>
</ul>
<div class="org-src-container">
<pre class="src src-sh">wget https://www.snort.org/downloads/community/snort3-community-rules.tar.gz
sudo tar -xvf ~/snort3-community-rules.tar.gz -C ~/
sudo cp ~/snort3-community-rules/* /etc/snort/rules
sudo mkdir /opt/snort/etc/snort/rules                   
sudo cp snort3-community.rules /opt/snort/etc/snort/rules/
sudo cp sid-msg.map /opt/snort/etc/snort/rules/          

<span style="color: #2aa1ae; background-color: #292e34;">###</span><span style="color: #2aa1ae; background-color: #292e34;">Snort 2.9X we were stored the rule in ~/etc/snort/~ That's different/opt/snort/etc/snort/rules/</span>

<span style="color: #2aa1ae; background-color: #292e34;">## </span><span style="color: #2aa1ae; background-color: #292e34;">test that snort load these rules correctly</span>
sudo snort -c snort.lua -R /opt/snort/etc/snort/rules/snort3-community.rules
<span style="color: #2aa1ae; background-color: #292e34;">## </span><span style="color: #2aa1ae; background-color: #292e34;">if you got this issue like this:</span>

<span style="color: #2aa1ae; background-color: #292e34;">## </span><span style="color: #2aa1ae; background-color: #292e34;">FATAL: can't init snort.lua: cannot open /snort_defaults.lua: No such file or directory</span>
  Fatal Error, Quitting&#12290;

<span style="color: #2aa1ae; background-color: #292e34;">### </span><span style="color: #2aa1ae; background-color: #292e34;">Now, change you file name that snort can load rules.</span>
<span style="color: #4f97d7;">cd</span> /opt/snort/etc/snort
sudo mv snort_defaults.lua ./snort_defaults.lua
sudo mv file_magic.lua ./file_magic.lua

<span style="color: #2aa1ae; background-color: #292e34;">### </span><span style="color: #2aa1ae; background-color: #292e34;">if you still have had this problem, check snort of the file_magic config dir.</span>
<span style="color: #2aa1ae; background-color: #292e34;">### </span><span style="color: #2aa1ae; background-color: #292e34;">Then test again:</span>
sudo snort -c snort.lua -R /opt/snort/etc/snort/rules/snort3-community.rules

<span style="color: #2aa1ae; background-color: #292e34;">## </span><span style="color: #2aa1ae; background-color: #292e34;">The output information:</span>
Snort successfully validated the configuration <span style="color: #4f97d7;">(</span>with <span style="color: #a45bad;">0</span> warnings<span style="color: #4f97d7;">)</span>.
o<span style="color: #2d9574;">")~   Snort exiting</span>
</pre>
</div>

<ul class="org-ul">
<li>Installing OpenAppID</li>
</ul>
<p>
first of all, download the OpenAppID detector package:
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #4f97d7;">cd</span> ~/snort_src/
wget https://www.snort.org/downloads/openappid/6329
tar -xzvf <span style="color: #a45bad;">6329</span>
sudo cp -R odp /opt/snort/lib/
</pre>
</div>


<div class="org-src-container">
<pre class="src src-sh">sudo nano /opt/snort/etc/snort/snort.lua
<span style="color: #2aa1ae; background-color: #292e34;">## </span><span style="color: #2aa1ae; background-color: #292e34;">find appid this line and add appid dir to here:</span>

<span style="color: #7590db;">appid</span> =
<span style="color: #4f97d7;">{</span>
    <span style="color: #7590db;">app_detector_dir</span> = <span style="color: #2d9574;">'/opt/snort/lib'</span>
<span style="color: #4f97d7;">}</span>

</pre>
</div>
<p>
Now, Test configuration:
<code>sudo snort -c /opt/snort/etc/snort/snort.lua --warn-all</code>
</p>
</div>
</li>
<li><a id="org8adb970"></a>CSV Output<br>
<div class="outline-text-5" id="text-1-1-5-3">
<p>
First of all, Setting up the format csv file for snort, lets just copy this command into the configuration file stored in <code>/etc/snort/snort.config</code>
</p>

<div class="org-src-container">
<pre class="src src-sh">output alert_csv: /var/log/snort/alert.csv timestamp,sig_id,sig_rev,msg,proto,src,srcport,dst,dstport,ethsrc,ethdst,ethlen,tcpflags,ttl,iplen
</pre>
</div>


<p>
##Snort3 +
sudo nano /opt/snort/etc/snort/snort.lua
</p>
<div class="org-src-container">
<pre class="src src-sh">output alert_csv: /var/log/snort/alert.csv timestamp,sig_id,sig_rev,msg,proto,src,srcport,dst,dstport,ethsrc,ethdst,ethlen,tcpflags,ttl,iplen
</pre>
</div>

<p>
For more information aboutï¼š 
<a href="http://manual-snort-org.s3-website-us-east-1.amazonaws.com/node21.html#SECTION00366100000000000000">Snort output format</a> <b>Click this url</b>
</p>


<p>
##Snort 2.9X  running bro
<code>sudo systemctl restart snort.service</code>
<code>sudo snort -i ens192 -c /etc/snort/snort.conf</code>
</p>

<p>
##Snort3 ++
<code>sudo nohup snort -i ens192 -c /opt/snort/etc/snort/snort.lua &amp;</code>
The <b>-i</b> option you can enter the interface card whatever you like to use to sniff packets form. and the <b>-c</b> point which configure file used.
</p>

<p>
###Snort 2.9x
before type the following command to restart the Snort:
<code>sudo systemctl restart snort.serivce</code>
Then, checking test.
<code>ps aux | grep snort</code>
</p>
</div>
</li>
</ol>
</div>
</div>
</div>


<div id="outline-container-org02b02a8" class="outline-2">
<h2 id="org02b02a8"><span class="section-number-2">2</span> Adding Patterns for ELk</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-org5e5bb24" class="outline-3">
<h3 id="org5e5bb24"><span class="section-number-3">2.1</span> Bro</h3>
<div class="outline-text-3" id="text-2-1">
<ol class="org-ol">
<li><a href="#org2468595">Logstrash Bro config file</a></li>
<li>ensure that you are finishing the bro config for logstrash (1.)</li>
<li>Index Patterns</li>
</ol>
<p>
cleaning console buffer that you are make sure able to load bro conf correctly.
</p>

<figure>
<img src="img/Console%20-%20Kibana%20.png" alt="Console%20-%20Kibana%20.png" width="1000">

</figure>

<p>
finally,
</p>

<figure>
<img src="img/index%20bro.png" alt="index%20bro.png" width="1000">

</figure>
</div>

<div id="outline-container-org2ce6299" class="outline-4">
<h4 id="org2ce6299"><span class="section-number-4">2.1.1</span> More information</h4>
</div>
</div>
<div id="outline-container-orgb95cd79" class="outline-3">
<h3 id="orgb95cd79"><span class="section-number-3">2.2</span> Suricata &amp; Snort</h3>
<div class="outline-text-3" id="text-2-2">
<ul class="org-ul">
<li>if you did install suricata with debian. click this link for you help. <a href="http://ral-arturo.org/2017/08/19/suricata-debian.html">http://ral-arturo.org/2017/08/19/suricata-debian.html</a></li>

<li>Checking Suricata status same like this:</li>
</ul>
<p>
<code>sudo systemctl status suricata</code>
</p>

<p>
â— suricata.service - Suricata IDS/IDP daemon
Loaded: loaded (/lib/systemd/system/suricata.service; disabled; vendor preset: enabled)
Active: inactive (dead)
Docs: man:suricata(8)
man:suricatasc(8)
</p>

<p>
<a href="https://redmine.openinfosecfoundation.org/projects/suricata/wiki">https://redmine.openinfosecfoundation.org/projects/suricata/wiki</a>
</p>

<p>
â€” go to Syslog-ng conf file, add following it here in <code>sensor host</code>:
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #4f97d7;">source</span> s_ids_suri <span style="color: #4f97d7;">{</span> file<span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"/var/log/suricata/eve.json"</span> flags<span style="color: #2d9574;">(</span>no-parse<span style="color: #2d9574;">)</span> program_override<span style="color: #2d9574;">(</span><span style="color: #2d9574;">"suricata"</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span>; <span style="color: #4f97d7;">}</span>;
<span style="color: #4f97d7;">source</span> s_ids_snort <span style="color: #4f97d7;">{</span> file<span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"/var/log/snort/alert.csv"</span> flags<span style="color: #2d9574;">(</span>no-parse<span style="color: #2d9574;">)</span> program_override<span style="color: #2d9574;">(</span><span style="color: #2d9574;">"snort"</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span>; <span style="color: #4f97d7;">}</span>;

destination d_ids <span style="color: #4f97d7;">{</span> network<span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"192.168.1.8"</span> port<span style="color: #2d9574;">(</span><span style="color: #a45bad;">1001</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span>; <span style="color: #4f97d7;">}</span>; <span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">manager host</span>

<span style="color: #4f97d7;">log</span> <span style="color: #4f97d7;">{</span>
        <span style="color: #4f97d7;">source</span><span style="color: #bc6ec5;">(</span>s_ids_snort<span style="color: #bc6ec5;">)</span>;
        <span style="color: #4f97d7;">source</span><span style="color: #bc6ec5;">(</span>s_ids_suri<span style="color: #bc6ec5;">)</span>;
        <span style="color: #4f97d7;">log</span> <span style="color: #bc6ec5;">{</span> destination<span style="color: #2d9574;">(</span>d_ids<span style="color: #2d9574;">)</span>; <span style="color: #bc6ec5;">}</span>;
<span style="color: #4f97d7;">}</span>;

</pre>
</div>
<p>
Then restart service:
<code>sudo systemctl restart syslog-ng.service</code>
and Adding partner same like this way to check:
</p>


<figure>
<img src="img/index%20bro.png" alt="index%20bro.png" width="1000">

</figure>
</div>
<div id="outline-container-orga2a0668" class="outline-4">
<h4 id="orga2a0668"><span class="section-number-4">2.2.1</span> More Information</h4>
<div class="outline-text-4" id="text-2-2-1">
<p>
For more information about Suricata, please see:
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-org843cfad" class="outline-2">
<h2 id="org843cfad"><span class="section-number-2">3</span> Adding a dashboard of data type</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-org584db15" class="outline-3">
<h3 id="org584db15"><span class="section-number-3">3.1</span> Bro</h3>
<div class="outline-text-3" id="text-3-1">
<ul class="org-ul">
<li>first of all, we need to create some visualizations.</li>
</ul>

<figure>
<img src="img/Kibana%202017-12-24%2001-46-08.png" alt="Kibana%202017-12-24%2001-46-08.png" width="1000">

</figure>
<ul class="org-ul">
<li>Pie of Bro file types</li>
</ul>

<figure>
<img src="img/Bro%20File%20Types.png" alt="Bro%20File%20Types.png" width="1000">

</figure>

<ul class="org-ul">
<li>Line of Bro events over time</li>
</ul>

<figure>
<img src="img/Bro%20Events%20over%20time.png" alt="Bro%20Events%20over%20time.png" width="1000">

</figure>
<ul class="org-ul">
<li>Metic of bro log</li>
</ul>

<figure>
<img src="img/Metric.png" alt="Metric.png" width="1000">

</figure>

<ul class="org-ul">
<li>Visual Builder of Src Bytes / Dst Bytes
<ol class="org-ol">
<li>personally, Clone series from src to dst and changed  color to pink</li>
</ol></li>
</ul>


<figure>
<img src="img/Src%20Bytes%20-%20Kibana%202017-12-25%2002-06-02.png" alt="Src%20Bytes%20-%20Kibana%202017-12-25%2002-06-02.png" width="1000">

</figure>

<ol class="org-ol">
<li>Second of all,changed bar in option</li>
</ol>


<figure>
<img src="img/src%20bar.png" alt="src%20bar.png" width="1000">

</figure>

<ol class="org-ol">
<li>finally, organizing your dashboard of Bro</li>
</ol>


<figure>
<img src="img/Bro%20Overviwe%20-%20Kibana%202017-12-25%2002-14-44.png" alt="Bro%20Overviwe%20-%20Kibana%202017-12-25%2002-14-44.png" width="1000">

</figure>

<ul class="org-ul">
<li>Top Conn log of Bro protocol</li>
</ul>


<figure>
<img src="img/Top%20conn%20log.png" alt="Top%20conn%20log.png" width="1000">

</figure>
</div>
<div id="outline-container-orga3cbb4b" class="outline-4">
<h4 id="orga3cbb4b"><span class="section-number-4">3.1.1</span> More Information</h4>
<div class="outline-text-4" id="text-3-1-1">
<p>
For more information about Suricata, please see:
</p>
</div>
</div>
</div>
<div id="outline-container-org7f95b22" class="outline-3">
<h3 id="org7f95b22"><span class="section-number-3">3.2</span> Snort &amp; Suricata</h3>
<div class="outline-text-3" id="text-3-2">
<p>
Metric of  Count Events 
</p>

<figure>
<img src="img/IDS%20Alert%20Count.png" alt="IDS%20Alert%20Count.png" width="1000">

</figure>
</div>
</div>
</div>



<div id="outline-container-orgbdfa26f" class="outline-2">
<h2 id="orgbdfa26f"><span class="section-number-2">4</span> Reference</h2>
<div class="outline-text-2" id="text-4">
<p>
<a href="https://s3.amazonaws.com/snort-org-site/production/release_files/files/000/005/901/original/snort_manual.pdf?AWSAccessKeyId=AKIAIXACIED2SPMSC7GA&amp;Expires=1514621909&amp;Signature=sD%2BAzw59lYfgVBfpcKa302sTppM%3D">Snort3 User Manual</a>
</p>

<p>
<a href="http://sublimerobots.com/2017/08/installing-snort-3-b239-in-ubuntu/">Installing Snort++ Example Plugins</a>
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: GTruN</p>
<p class="date">Created: 2017-12-31 Sun 23:57</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
